{{ define "body_classes" }}page-default-list{{ end }}

{{ define "main" }}
<div class="intro">
  <div class="container">
    <div class="row justify-content-start">
      <div class="col-12 col-md-7 col-lg-6 order-2 order-md-1">
        {{ .Content }}
      </div>
      {{ partial "intro-image.html" . }}
    </div>
  </div>
</div>

<div class="container pt-6 pb-md-12">
  <div class="row">
    {{ range .Pages.ByWeight }}
    <div class="col-12 col-md-6 mb-2 ">{{ .Render "summary" }}</div>
    {{ end }}
  </div>
</div>

<!-- PhotoSwipe -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@5.4.2/dist/photoswipe.css">
{{ end }}

{{ define "footer_js" }}
<script src="https://cdn.jsdelivr.net/npm/photoswipe@5.4.2/dist/photoswipe.umd.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
  // Initialize PhotoSwipe for all images
  const images = document.querySelectorAll('.content img, .intro img, article img');
  
  images.forEach((img, index) => {
    // Skip if already processed
    if (img.hasAttribute('data-pswp-processed')) return;
    img.setAttribute('data-pswp-processed', 'true');
    
    // Make images clickable
    img.style.cursor = 'pointer';
    
    img.addEventListener('click', function() {
      // Build items array from all images on the page
      const allImages = document.querySelectorAll('.content img, .intro img, article img');
      const currentItems = [];
      let clickedIndex = 0;
      
      allImages.forEach((imgEl, idx) => {
        if (imgEl === img) clickedIndex = idx;
        currentItems.push({
          src: imgEl.src,
          width: imgEl.naturalWidth || imgEl.width || 1200,
          height: imgEl.naturalHeight || imgEl.height || 800,
          alt: imgEl.alt || ''
        });
      });
      
      const options = {
        index: clickedIndex,
        bgOpacity: 0.9,
        showHideAnimationType: 'fade',
        zoomAnimationDuration: 200,
        dataSource: currentItems
      };
      
      const gallery = new PhotoSwipe(options);
      gallery.init();
    });
  });
  
  // Enable pinch zoom on touch devices for inline images
  if ('ontouchstart' in window) {
    images.forEach(img => {
      let initialDistance = 0;
      let currentScale = 1;
      let initialScale = 1;
      let lastTouchEnd = 0;
      let isZooming = false;
      
      img.addEventListener('touchstart', function(e) {
        if (e.touches.length === 2) {
          isZooming = true;
          e.preventDefault();
          const touch1 = e.touches[0];
          const touch2 = e.touches[1];
          initialDistance = Math.hypot(
            touch2.clientX - touch1.clientX,
            touch2.clientY - touch1.clientY
          );
          initialScale = currentScale;
        }
      });
      
      img.addEventListener('touchmove', function(e) {
        if (e.touches.length === 2 && isZooming) {
          e.preventDefault();
          const touch1 = e.touches[0];
          const touch2 = e.touches[1];
          const currentDistance = Math.hypot(
            touch2.clientX - touch1.clientX,
            touch2.clientY - touch1.clientY
          );
          
          const scale = initialScale * (currentDistance / initialDistance);
          currentScale = Math.max(1, Math.min(scale, 5)); // Limit zoom between 1x and 5x
          
          img.style.transform = `scale(${currentScale})`;
          img.style.transformOrigin = 'center center';
          img.style.transition = 'none';
        }
      });
      
      img.addEventListener('touchend', function(e) {
        if (e.touches.length < 2) {
          if (isZooming) {
            img.style.transition = 'transform 0.3s';
            isZooming = false;
          }
          
          // Double tap to reset
          const now = Date.now();
          if (now - lastTouchEnd <= 300) {
            currentScale = 1;
            img.style.transform = 'scale(1)';
          }
          lastTouchEnd = now;
        }
      });
    });
  }
});
</script>
{{ end }}
